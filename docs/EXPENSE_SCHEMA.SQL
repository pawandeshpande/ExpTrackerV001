


DROP USER 'expense'@'localhost';

CREATE USER 'expense'@'localhost' IDENTIFIED BY 'expense';
GRANT SELECT,INSERT,UPDATE,DELETE,CREATE,DROP   ON expensedb.*   TO 'expense'@'localhost';

USE EXPENSEDB;


TRUNCATE TABLE COMPANY;
TRUNCATE TABLE EXPENSES;
TRUNCATE TABLE USER;
TRUNCATE TABLE BORROWER;
TRUNCATE TABLE EXPENSE_TYPE;
TRUNCATE TABLE EVENT;
TRUNCATE TABLE PAYMENT_MODE;

DROP TABLE EXPENSES;
DROP TABLE BORROWER;
DROP TABLE EXPENSE_TYPE;
DROP TABLE EVENT;
DROP TABLE PAYMENT_MODE;

DROP TABLE USER;

DROP TABLE COMPANY;


CREATE TABLE COMPANY( ROW_ID MEDIUMINT AUTO_INCREMENT     PRIMARY KEY ,
 NAME VARCHAR(30) ,
 ADDRESS VARCHAR(255) ,
 PRIMARY_CONTACT VARCHAR(10), 
 CREATED DATETIME ,
  CREATED_BY MEDIUMINT,
  UPDATED DATETIME ,
  UPDATED_BY MEDIUMINT,
  ACTIVE_FLG CHAR(1),
 DELETED_STATE CHAR(1));
    
    
CREATE TABLE USER( ROW_ID MEDIUMINT AUTO_INCREMENT    PRIMARY KEY ,
 NAME VARCHAR(30) ,
 USERNAME VARCHAR(30) ,
 PASSWORD VARCHAR(100) ,
 CREATED DATETIME ,
 CREATED_BY MEDIUMINT,
 UPDATED DATETIME ,
 UPDATED_BY MEDIUMINT,
 ACTIVE_FLG CHAR(1),
 DELETED_STATE CHAR(1),
 BU_ID MEDIUMINT );
 
     
CREATE TABLE BORROWER( ROW_ID MEDIUMINT AUTO_INCREMENT    PRIMARY KEY ,
 FIRSTNAME VARCHAR(30) ,
 LASTNAME VARCHAR(30) ,
 ADDRESS VARCHAR(255) ,
 CREATED DATETIME ,
 CREATED_BY MEDIUMINT,
 UPDATED DATETIME ,
 UPDATED_BY MEDIUMINT,
 ACTIVE_FLG CHAR(1),
 DEFAULT_FLG CHAR(1),
 DELETED_STATE CHAR(1),
 BU_ID MEDIUMINT);



    
CREATE TABLE EXPENSE_TYPE( ROW_ID MEDIUMINT AUTO_INCREMENT    PRIMARY KEY ,
 NAME VARCHAR(30) ,
 DESCRIPTION VARCHAR(255) ,
 CREATED DATETIME ,
 CREATED_BY MEDIUMINT,
 UPDATED DATETIME ,
 UPDATED_BY MEDIUMINT,
 ACTIVE_FLG CHAR(1),
 DEFAULT_FLG CHAR(1),
 DELETED_STATE CHAR(1),
 BU_ID MEDIUMINT);



    
CREATE TABLE EVENT( ROW_ID MEDIUMINT AUTO_INCREMENT    PRIMARY KEY ,
 NAME VARCHAR(30) ,
 DESCRIPTION VARCHAR(255),
 CREATED DATETIME ,
 CREATED_BY MEDIUMINT,
 UPDATED DATETIME ,
 UPDATED_BY MEDIUMINT,
 ACTIVE_FLG CHAR(1),
 DEFAULT_FLG CHAR(1),
 DELETED_STATE CHAR(1),
 BU_ID MEDIUMINT );


    
    
CREATE TABLE PAYMENT_MODE( ROW_ID MEDIUMINT AUTO_INCREMENT    PRIMARY KEY ,
 NAME VARCHAR(30) ,
 DESCRIPTION VARCHAR(255),
 CARD_NO VARCHAR(16) ,
 ACCOUNT_NO VARCHAR(20) ,
 BU_ID MEDIUMINT ,
 CREATED DATETIME ,
 CREATED_BY MEDIUMINT,
 UPDATED DATETIME ,
 UPDATED_BY MEDIUMINT, 
 ACTIVE_FLG CHAR(1),
 DELETED_STATE CHAR(1),
 DEFAULT_FLG CHAR(1));




CREATE TABLE EXPENSES( ROW_ID  INT  AUTO_INCREMENT    PRIMARY KEY ,
 BILL_NO VARCHAR(10) ,
 BILL_DATE DATE ,
 NAME  VARCHAR(30) ,
 DESCRIPTION VARCHAR(255) ,
 SERIAL_NO VARCHAR(50),
 QUANTITY NUMERIC(6,2),
 UNIT_PRICE NUMERIC(8,2),
 AMOUNT NUMERIC(8,2) ,
 TAX NUMERIC(4,2) ,
 TOTAL_AMT NUMERIC(8,2) ,
 CREATED DATETIME ,
 CREATED_BY MEDIUMINT,
 UPDATED DATETIME ,
 UPDATED_BY MEDIUMINT,
 EXPENSE_TYPE_ID MEDIUMINT,
 BORROWER_ID MEDIUMINT ,
 COMMENTS VARCHAR(255) ,
 BU_ID MEDIUMINT ,
 EVENT_ID MEDIUMINT ,
 DELETED_STATE CHAR(1),
 PAYMENT_MODE_ID MEDIUMINT );



-- Create foreign key references : USER Table
ALTER TABLE USER ADD FOREIGN KEY( BU_ID)   REFERENCES COMPANY(ROW_ID); 

-- Create foreign key references : BORROWER Table
ALTER TABLE BORROWER ADD FOREIGN KEY (CREATED_BY) REFERENCES USER(ROW_ID); 
ALTER TABLE BORROWER ADD FOREIGN KEY (UPDATED_BY) REFERENCES USER(ROW_ID);     
ALTER TABLE BORROWER ADD FOREIGN KEY (BU_ID) REFERENCES COMPANY(ROW_ID); 

-- Create foreign key references : EXPENSE_TYPE Table
ALTER TABLE EXPENSE_TYPE ADD FOREIGN KEY (CREATED_BY) REFERENCES USER(ROW_ID); 
ALTER TABLE EXPENSE_TYPE ADD FOREIGN KEY (UPDATED_BY) REFERENCES USER(ROW_ID);     
ALTER TABLE EXPENSE_TYPE ADD FOREIGN KEY (BU_ID) REFERENCES COMPANY(ROW_ID); 

-- Create foreign key references : EVENT Table
ALTER TABLE EVENT ADD FOREIGN KEY (CREATED_BY) REFERENCES USER(ROW_ID); 
ALTER TABLE EVENT ADD FOREIGN KEY (UPDATED_BY) REFERENCES USER(ROW_ID);     
ALTER TABLE EVENT ADD FOREIGN KEY (BU_ID) REFERENCES COMPANY(ROW_ID); 


-- Create foreign key references : PAYMENT_MODE Table
ALTER TABLE PAYMENT_MODE ADD FOREIGN KEY (CREATED_BY) REFERENCES USER(ROW_ID); 
ALTER TABLE PAYMENT_MODE ADD FOREIGN KEY (UPDATED_BY) REFERENCES USER(ROW_ID);     
ALTER TABLE PAYMENT_MODE ADD FOREIGN KEY (BU_ID) REFERENCES COMPANY(ROW_ID); 



-- Create foreign key references : EXPENSES Table
ALTER TABLE EXPENSES ADD FOREIGN KEY (CREATED_BY) REFERENCES USER(ROW_ID); 
ALTER TABLE EXPENSES ADD FOREIGN KEY (UPDATED_BY) REFERENCES USER(ROW_ID);     
ALTER TABLE EXPENSES ADD FOREIGN KEY (BU_ID) REFERENCES COMPANY(ROW_ID); 
ALTER TABLE EXPENSES ADD FOREIGN KEY (EVENT_ID) REFERENCES EVENT(ROW_ID); 
ALTER TABLE EXPENSES ADD FOREIGN KEY (PAYMENT_MODE_ID ) REFERENCES PAYMENT_MODE(ROW_ID);
ALTER TABLE EXPENSES ADD FOREIGN KEY (BORROWER_ID ) REFERENCES BORROWER(ROW_ID); 
ALTER TABLE EXPENSES ADD FOREIGN KEY (EXPENSE_TYPE_ID ) REFERENCES EXPENSE_TYPE(ROW_ID);



-- After creating all the tables we need to insert the default company and user.


-- Create Default company

INSERT INTO COMPANY(NAME, ADDRESS, PRIMARY_CONTACT,ACTIVE_FLG,DELETED_STATE, 
CREATED,CREATED_BY, UPDATED, UPDATED_BY) VALUES("Default", "Bangalore", "Admin", 'Y','N', curdate(),-1,curdate(),-1); 


-- Create Default User

INSERT INTO USER(NAME ,
 USERNAME ,
 PASSWORD ,
 CREATED ,
 CREATED_BY ,
 UPDATED ,
 UPDATED_BY ,
 BU_ID, 
 ACTIVE_FLG,
 DELETED_STATE ) VALUES("Administrator", "Admin", password('Admin'), curdate(), -1, curdate(), -1, 1,'Y','N'); 
























